<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® Live Rescuer Dashboard</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        #alert-count {
            font-size: 2rem;
            color: #e74c3c;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .alert-item {
            background: #fff;
            border: 3px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .alert-item h3 {
            color: #c0392b;
            margin-top: 0;
        }

        .alert-item p {
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .alert-item a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }

        .time {
            color: #7f8c8d;
            font-size: 0.8rem;
        }

        /* Blinking indicator for new alerts */
        .blinking {
            animation: blink-receive 1s infinite alternate;
        }

        @keyframes blink-receive {
            from {
                background-color: #ffcccc;
            }

            to {
                background-color: #fff;
            }
        }
    </style>
</head>

<body>
    <h1>üö® Live SOS Alert Monitor</h1>
    <div id="alert-count">Active Alerts: 0</div>
    <div id="alerts-container">
        <p style="text-align: center; color: #7f8c8d;">Awaiting first SOS signal...</p>
    </div>

    <script>
        // ‚ö†Ô∏è 2. UPDATE THIS TO YOUR FIREBASE/SUPABASE REALTIME ENDPOINT ‚ö†Ô∏è
        const RESCUER_API_ENDPOINT = "https://your-unique-firebase-app.firebaseio.com/sos_alerts.json";
        // ------------------------------------------------------------------

        const container = document.getElementById('alerts-container');
        const alertCountDisplay = document.getElementById('alert-count');

        let lastAlertCount = 0;

        // Function to fetch and display alerts (Simulates listening)
        async function fetchSOSAlerts() {
            try {
                // Fetches ALL data sent to the server (you would adjust this for a real API)
                const response = await fetch(RESCUER_API_ENDPOINT);
                const data = await response.json();

                if (!data) {
                    container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">No alerts found yet.</p>';
                    lastAlertCount = 0;
                    return;
                }

                // Convert Firebase JSON object into an array of alerts
                const alerts = Object.keys(data).map(key => ({
                    id: key,
                    ...data[key]
                })).reverse(); // Show newest first

                // Update counter and check for new alerts
                if (alerts.length > lastAlertCount) {
                    document.body.classList.add('blinking');
                    setTimeout(() => document.body.classList.remove('blinking'), 4000);
                }
                lastAlertCount = alerts.length;
                alertCountDisplay.textContent = `Active Alerts: ${alerts.length}`;


                // Render alerts
                container.innerHTML = '';
                alerts.forEach(alert => {
                    const time = new Date(alert.timestamp).toLocaleTimeString();
                    const date = new Date(alert.timestamp).toLocaleDateString();

                    const item = document.createElement('div');
                    item.className = 'alert-item';
                    item.innerHTML = `
                        <h3>üö® NEW ALERT - ${alert.status.replace('_', ' ')}</h3>
                        <p><strong>Coordinates:</strong> ${alert.latitude}, ${alert.longitude}</p>
                        <p><strong>Address:</strong> ${alert.human_address}</p>
                        <p><strong>Accuracy:</strong> ${alert.accuracy_m} meters</p>
                        <p class="time">Received: ${date} at ${time}</p>
                        <a href="${alert.map_link}" target="_blank">View on Google Maps ¬ª</a>
                    `;
                    container.appendChild(item);
                });

            } catch (error) {
                console.error("Dashboard failed to connect to server:", error);
                container.innerHTML = '<p style="text-align: center; color: red;">ERROR: Cannot connect to alert server. Check API URL.</p>';
            }
        }

        // Poll the server every 5 seconds to check for new alerts
        fetchSOSAlerts();
        setInterval(fetchSOSAlerts, 5000);

    </script>
</body>

</html>